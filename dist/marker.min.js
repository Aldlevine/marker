!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Marker=t()}}(function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return r(n||t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";var i=t("./marker.js");e.exports=i.Marker},{"./marker.js":3}],2:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n.Magnifier=function(){function t(e){i(this,t),this.marker=e,this.element=$("<div>").addClass("magnifier"),this.text=$("<div>").addClass("magnifier-text").appendTo(this.element),this.pointer=$("<div>").addClass("magnifier-pointer").appendTo(this.element),$("body").append(this.element)}return r(t,[{key:"show",value:function(t,e){var n=$(t),i=n.position(),r=$("body"),o=r.width(),s=r.outerWidth(),a=r.position();e+=window.scrollX||document.documentElement.scrollLeft,e-=(s-o)/2,this.text.html(n.html()),this.element.attr("data-mark",this.marker.color),this.element.attr("data-mark-first",n.is(":first-child")),this.element.attr("data-mark-last",n.is(":last-child"));var l=this.element.outerWidth(),u=Math.min(Math.max(e-l/2,0-a.left),s+a.left-l);u=Math.max(Math.min(i.left+n.width()-l/2,u),i.left-l/2);var h=i.top-this.element.height();this.element.css({left:u,top:h}),this.pointer.css({left:Math.min(Math.max(e-u,20),this.element.outerWidth()-22,n.width()+i.left-u)}),this.element.addClass("show")}},{key:"hide",value:function(){this.element.removeClass("show")}}]),t}()},{}],3:[function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Marker=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t("./utils"),a=t("./magnifier.js"),l=t("./styler.js"),u=t("./touchhold.js");n.Marker=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.colors,o=void 0===i?{0:"#f2f2f2",1:"#8af58a",2:"#ff8080"}:i;r(this,t),$(e).addClass("marker"),$(e).attr("data-is-highlighting",!1),this.el=$(e),this.colors=o,this.color=0,this.currentHMark=null,this.start=null,this.startX=null,this.startY=null,this.end=null,this.endX=null,this.endY=null,this.isHeld=!1,this.touchhold=new u.Touchhold("body"),this.magnifier=new a.Magnifier(this),this.styler=new l.Styler,this.embedStyles(),this.wrapWords(),this.registerEvents()}return o(t,[{key:"embedStyles",value:function(){for(var t in this.colors){var e;this.styler.set(i({".marker":(e={},i(e,'[data-mark="'+t+'"]',{background:this.colors[t]}),i(e,'&[data-is-highlighting="false"][data-is-touching="false"][data-mark="'+t+'"]\n          .mark-word:hover',{background:this.colors[t]}),e)},'.magnifier[data-mark="'+t+'"] .magnifier-text',{background:this.colors[t]}))}}},{key:"wrapWords",value:function(){var t=$(this.el).find("*"),e=void 0;(0,s.walkElements)(t[0],t.last()[0],!0,function(t,n){if(3==t.nodeType){var i=t.textContent.split(/\s+/),r=[],o=t,s=!0,a=!1,l=void 0;try{for(var u,h=i[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value;c.length&&(o=$('<span class="mark-word">'+c+"</span>"),r.push(o))}}catch(t){a=!0,l=t}finally{try{!s&&h.return&&h.return()}finally{if(a)throw l}}return o!==t&&$(t).replaceWith(r),o}if((e=$(t)).is(":empty")&&!e.is("br,hr"))return e.wrap($('<span class="mark-word mark-atom">'))})}},{key:"highlightWords",value:function(t){var e=t[0],n=$('<span data-mark="'+this.color+'"/>');return $(e).before(n),n.append(t),this.currentMark=(this.currentMark||$()).add(n),n}},{key:"startHighlight",value:function(t){$(this.el).attr("data-is-highlighting",!0),this.start=t,this.end=t,this.currentMark=$(),this.highlight(t,t)}},{key:"cancelHighlight",value:function(){$(this.el).attr("data-is-highlighting",!1),this.start=null,this.end=null,this.currentMark=null}},{key:"moveHighlight",value:function(t){this.highlight(this.start,this.end=t)}},{key:"endHighlight",value:function(){$(this.el).attr("data-is-highlighting",!1),this.start=null,this.currentMark=null,this.normalizeHighlights()}},{key:"highlight",value:function(t,e){var n=this;this.currentMark&&(this.removeHighlight(this.currentMark),this.currentMark=$());var i=$();(0,s.walkElements)(t,e,!1,function(t,e){if(e&&i.length){var r=n.highlightWords(i)[0];return i=$(),r}$(t).is(".mark-word")&&(i=i.add(t))}),i.length&&this.highlightWords(i)}},{key:"removeHighlight",value:function(t){t.each(function(){var t=$(this);t.replaceWith(t.contents())})}},{key:"clearHighlights",value:function(){$(this.el).find("[data-mark]").not(this).each(function(){$(this).replaceWith($(this).contents())})}},{key:"normalizeHighlights",value:function(){$(this.el).find("[data-mark]").not(this).filter(":empty").remove(),$(this.el).find("[data-mark]").not(this).children("[data-mark]").each(function(){var t=$(this),e=t.parent();if(t.attr("data-mark")==e.attr("data-mark"))return void t.replaceWith(t.contents());var n=e.children().first().nextUntil(this).addBack(),i=t.nextAll();n.length&&e.before($(e[0].cloneNode()).append(n)),i.length&&e.after($(e[0].cloneNode()).append(i)),e.replaceWith(t)}),$(this.el).find('[data-mark="0"]').not(this).each(function(){var t=$(this);t.replaceWith(t.contents())}),$(this.el).find("[data-mark]").not(this).filter(":empty").remove(),$(this.el).find("[data-mark]").not(this).next("[data-mark]").each(function(){var t=$(this),e=t.prev();t.attr("data-mark")==e.attr("data-mark")&&(e.append(t.contents()),t.remove())})}},{key:"setColor",value:function(t){this.color=t,$(this.el).attr("data-mark",t)}},{key:"registerEvents",value:function(){var t=this;$("body").on("touchhold mousedown",function(e){return t.startEvent(e)}).on("touchmove mousemove",function(e){return t.moveEvent(e)}).on("touchend touchcancel mouseup",function(e){return t.endEvent(e)}),this.el.find(".mark-word").on("click",function(e){return t.clickEvent(e)}),this.touchswap()}},{key:"startEvent",value:function(t){if(("mousedown"!=t.type||1==t.which)&&0!=$(this.el).has(t.target).length){"touchhold"==t.type&&(this.isHeld=!0);var e=(0,s.getCoords)(t),n=e.x,i=e.y,r=(0,s.getClosestElement)(n,i,".mark-word");r&&(this.startHighlight(r),this.isHeld&&this.magnifier.show(r,n),this.startX=n,this.startY=i,this.endX=n,this.endY=i)}}},{key:"moveEvent",value:function(t){if(this.start){if("touchmove"==t.type&&!this.isHeld)return void this.cancelHighlight();t.preventDefault();var e=(0,s.getCoords)(t),n=e.x,i=e.y,r=(0,s.getClosestElement)(n,i,".mark-word",16,6);r||(r=(0,s.getElementInSpray)(n,i,this.startX,this.startY,".mark-word")),r&&(this.moveHighlight(r),this.isHeld&&this.magnifier.show(r,n),this.endX=n,this.endY=i)}}},{key:"endEvent",value:function(t){this.endHighlight(),this.magnifier.hide(),this.isHeld=!1}},{key:"clickEvent",value:function(t){this.highlight(t.target,t.target)}},{key:"touchswap",value:function(){var t=this;this.el.attr("data-is-touching",!1),$(window).on("touchstart touchend",function(){t.el.attr("data-is-touching",!0)})}}]),t}()},{"./magnifier.js":2,"./styler.js":4,"./touchhold.js":5,"./utils":10}],4:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n.Styler=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),this.element=document.createElement("style"),$("body").append(this.element),this.sheet=this.element.sheet,this.rules={},this.set(e)}return o(t,[{key:"set",value:function(t,e){if(t&&"object"===(void 0===t?"undefined":r(t))){var n=t;for(var i in n)this.set(i,n[i])}else{t=t.replace(/\s+/g," ");var o=this.rules[t];if(o)for(var s in e)e[s]&&"object"===r(e[s])?this.set(this.joinSelectors(t,s,e[s])):o.style[s]=e[s];else{var a="";for(var l in e)e[l]&&"object"===r(e[l])?this.set(this.joinSelectors(t,l),e[l]):a+=l+":"+e[l]+";";a.length&&(this.rules[t]=this.sheet.cssRules[this.sheet.insertRule(t+"{"+a+"}",this.sheet.cssRules.length)])}}}},{key:"joinSelectors",value:function(t,e){return/&/.test(e)?e.replace(/&/g,t):t+" "+e}}]),t}()},{}],5:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n.Touchhold=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.ms,o=void 0===r?375:r,s=n.distance,a=void 0===s?10:s;i(this,t),this.el=e,this.ms=o,this.distance=a,this.distanceSq=a*a,this.startX=null,this.startY=null,this.startScrollX=null,this.startScrollY=null,this.timer=null,this.touchdown(),this.touchmove(),this.touchend()}return r(t,[{key:"touchdown",value:function(){var t=this;$("body").on("touchstart mousedown",function(e){clearTimeout(t.timer);var n=void 0;if(e.touches){if(e.touches.length>1)return;n=e.touches[0]}else{if(1!=e.which)return;n=e}t.startX=n.clientX,t.startY=n.clientY,t.startScrollX=window.scrollX||document.documentElement.scrollLeft,t.startScrollY=window.scrollY||document.documentElement.scrollTop,t.timer=setTimeout(function(){return t.emitTouchhold(e)},t.ms)})}},{key:"touchmove",value:function(){var t=this;$(document).on("touchmove mousemove",function(e){var n=void 0;if(e.touches){if(e.touches.length>1)return void clearTimeout(t.timer);n=e.touches[0]}else n=e;var i=n,r=i.clientX,o=i.clientY,s=r-t.startX,a=o-t.startY;s*s+a*a>t.distanceSq&&clearTimeout(t.timer)})}},{key:"touchend",value:function(){var t=this;$(document).on("touchend touchcancel mouseup",function(e){clearTimeout(t.timer)})}},{key:"emitTouchhold",value:function(t){t.type="touchhold",$(this.el).trigger(t)}}]),t}()},{}],6:[function(t,e,n){"use strict";function i(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:9,o=document.elementFromPoint(t,e);if(o&&(!n||$(o).is(n)))return o;for(var s=2*Math.PI/r,a=void 0,l=void 0,u=0;u<r;u++)if(a=Math.cos(s*u),l=Math.sin(s*u),(o=document.elementFromPoint(t+a*i,e+l*i))&&(!n||$(o).is(n)))return o}Object.defineProperty(n,"__esModule",{value:!0}),n.getClosestElement=i},{}],7:[function(t,e,n){"use strict";function i(t){var e=void 0,n=void 0;if(t.touches){var i=t.touches[0];e=i.clientX,n=i.clientY}else e=t.clientX,n=t.clientY;return{x:e,y:n}}Object.defineProperty(n,"__esModule",{value:!0}),n.getCoords=i},{}],8:[function(t,e,n){"use strict";function i(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,s=n-t,a=i-e,l=Math.sqrt(s*s+a*a),u=s/l,h=a/l,c=u*o,f=h*o,d=document.elementFromPoint(t,e);if(d&&(!r||$(d).is(r)))return d;for(var m=0,v=l/o;m<v;m++)if((d=document.elementFromPoint(t+c*m,e+f*m))&&(!r||$(d).is(r)))return d}Object.defineProperty(n,"__esModule",{value:!0}),n.getElementInLine=i},{}],9:[function(t,e,n){"use strict";function i(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI/6,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,l=n-t,u=i-e,h=Math.sqrt(l*l+u*u),c=l/h,f=u/h,d=Math.atan2(f/c),m=d-s*a/2,v=document.elementFromPoint(t,e);if(v&&(!r||$(v).is(r)))return v;for(var g=void 0,y=void 0,p=0,k=h/o;p<k;p++)for(var b=0;b<a;b++)if(g=Math.cos(m+s*b),y=Math.sin(m+s*b),(v=document.elementFromPoint(t+g*o*p,e+y*o*p))&&(!r||$(v).is(r)))return v}Object.defineProperty(n,"__esModule",{value:!0}),n.getElementInSpray=i},{}],10:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./get-closest-element.js");Object.keys(i).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return i[t]}})});var r=t("./get-coords.js");Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return r[t]}})});var o=t("./get-element-in-line.js");Object.keys(o).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return o[t]}})});var s=t("./get-element-in-spray.js");Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return s[t]}})});var a=t("./walk-elements.js");Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(n,t,{enumerable:!0,get:function(){return a[t]}})})},{"./get-closest-element.js":6,"./get-coords.js":7,"./get-element-in-line.js":8,"./get-element-in-spray.js":9,"./walk-elements.js":11}],11:[function(t,e,n){"use strict";function i(t,e,n,i){if(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING){var r=t;t=e,e=r}for(var o=$(t),s=($(e),o),a=void 0,l=void 0,u=0,h=void 0,c=!1,f=n?"contents":"children";;)if(h=i(s[0],u),u=0,h&&(s=$(h)),s.is(e)&&(c=!0),!(a=s[f]()).length||h){for(;!(l=s[0].nextSibling);)s=s.parent(),u=-1;if(-1!=u){if(c)break;s=$(l)}else{if(c)break;s=$(l)}}else s=a.first(),u=1}Object.defineProperty(n,"__esModule",{value:!0}),n.walkElements=i},{}]},{},[1])(1)});